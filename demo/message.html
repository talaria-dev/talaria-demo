<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <title>Talaria Media Message</title>
  <meta name="description" content="Talaria Media Message">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">  
  
  <link rel="icon" type="image/png" sizes="64x64"  href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABBVJREFUeNrsW01oE0EUno0Fgz0YkaIoSKIgKmLSQ0EvbXKsl1YQWi8mOXoqvXlKSM5K6KnHJKdSKCS52IuQtB4sWMhGMFYRjYJ/lNJ4qEQo6Lw4xc1kNvuT7O5M1gePDdNms++b7/3NzkjIYknMbYbxBTSI1Y81pPEVGWsDaw1rJb06WbHy+SQLDPbhyyzWGXIdhBSxluCKAWlyCQA2HGZ2AWvMYlLlsOYHxQxpQBRPEprbKQBAql8gpD6pnrFhxvUwYtGsa0gmjQffzmL1IT4EjI9jEIqWA4CNz3Iw66pswCDELQGAUL6sI405LZBGI3pdQhoy4w2DIOk0/gNH/m4kLoxjEBq9/smjc+ZFMx6RZy4QG8wBIBjtWRIiNhh3AVa0P+sfRd4TI9xb3aj/0J0dpB55vkCPxxM3kP/aSe4BqKx9QuW1j/TwHVad4FHx+6zAtEfhuxfQlYnT9HCWFQ9YMSAjaNDrnO4Hl5FvzEsHxUxPAEhjEzPgW9wKxCoAgZIYsVGVAcleN93fbQnFAohXoakzqJeNHsbKjarsbO+h1s9DoUCYjl5E3tGOzBUmaxddDIhq3ax1cIi2nnwRCgBwhVvT5+nhhQ4ASHTU1eFBehEpFoDcvH2OFQt8SgYYWrtbeVxH8sZ3oVjAiAWzSgBmjNwQXKGw/BZl0y+FiQtXu+uCts0jZhigTIuiuQPNAIlE/zJyp0Q8yP7VXK6qZnCBoJ2/6HRHSblsEJ7Eb2thcv+Sox1lcv5ZR7HoEXzBw7BQDVLI4zan940d12yHXSW2A9DkrKO0HYAqZyW07QDwVj06EgOgj+Clf3AEAIgD0Eg5EQ+au7+6AJCdAOFb4wAtP6y2l7DtBIL6LRkqwYZTxRC01bDAAgoFCp2j7QhJAEANDW4zU18z44BL1MAFKi6ugyrtV2OJuc3fbrQ+vTopHfWlRR7coJdABwnvJs0KLN2tPKorh4rKNFga9tl+/WKPHiopASgOs/FQdDFWsf8xgOylyfFsBF3AGBHGy5zc0f4hZSW4xDcALVPlM3zn+fpnejjfVQpjRGTeU+JOtx9rynr+fbvgUqY+5fZauhdI8QwAYyY1O0+G76dUmyGCDLexAPoH6B30Uh+6TobvV7S6wUX0d48dlwJ9w5YOJoDxVGndJLZ1yDF6YONVtjV1Pf4Gf5znFYR3tf02vU+1Gyhvd32LWbL99Cs9fI/EuQ4xtE2OR2F1kX1vk1OAUEXivzeQsfHjan/UWhGKOLVgMijjiQ2qomeztB9fgAkibpYOaO0Y11wTJLutA4IxQdZjvC4GKJjg3gMTAmUH647MUCAMzaEpU+8FyA8FOCmbc8TfTa1p/D84OainIUBEkT1HZ5dYZa2jAFDZwn2HpzWYAcrl8fk/AgwALwul9z7tfHgAAAAASUVORK5CYII="> 

  <link href="https://vjs.zencdn.net/7.8.4/video-js.css" rel="stylesheet" />
  <script src="../client/v1/sylrtc-client.js"></script>
</head>
<body>

<style>
  .video-js {
    width: 100%;
    height: 480px;
  }

  .wrapper {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    max-width: 640px;
    margin: 0 auto;
  }

  #title {
    margin: 30px 20px;
  }

  #info {
    font-size: 18px;
    padding: 0 20px;
    text-align: center;
    margin-bottom: 40px;
  }
</style>


<header>
  <img src="./talaria_logo_hor.svg" alt="Talaria Logo" height="42">
  <h1>Media Message</h1>
</header>

<div class="wrapper">
  <div class="syl-card">
    <h2 id="title"></h2>
    <p id="info"></p>
  </div>
    
  <div class="syl-card">  
    <video    
      class="video-js"
      controls
      preload="auto"    
      data-setup="{}"
    >
      <p class="vjs-no-js">
        To view this video please enable JavaScript, and consider upgrading to a
        web browser that
        <a href="https://videojs.com/html5-video-support/" target="_blank"
          >supports HTML5 video</a
        >
      </p>
    </video>
  </div> 
</div>


<script lang="javascript">
function init(){
  var url_string = location.href;
  var url = new URL(url_string);
  var message_id = url.searchParams.get("message_id");
  console.log("message_id="+message_id);
  
  var base_url = location.protocol+ '//'+ location.host+ '/uploads/message-'+ message_id;

  var mp4_file_url = base_url+ '.' + 'mp4';
  var webm_file_url = base_url+ '.' +'webm';
  
  $('video').append('' + 
    '<source src="'+ mp4_file_url+ '" type="video/mp4" />' +
    '<source src="'+ webm_file_url+ '" type="video/webm" />'
  );
  
  $.get( "/api/av_message/", { message_id: message_id }, function(data, status, xhr) {
    console.log(data);
    if (data.error) {
      $('#info').html('Error: Invalid message id');
      $('#info').addClass('error');
        
    } else {
      var expiration_time= data.data.expiration_time;
      var sent_at = data.data.created_at;
      var title = data.data.title;
      var exp_localtime= new Date(data.data.expiration_time).toString().split(" GMT")[0];
      var sent_localtime= new Date(data.data.created_at).toString().split(" GMT")[0];
      if (title){
        $('#title').html(title);
        $ ('#info').html(data.data.sender_full_name+ ' recorded this at '+ sent_localtime+ ', and it will be available till '+ exp_localtime+ '.');
      }else{
        $('#title').html('Message from ' + data.data.sender_full_name);
        $('#info').html(data.data.sender_full_name+ ' recorded this meesage for you at '+ sent_localtime+ '. This message will be available till '+ exp_localtime+ '.');
      }
        
    }
  });
}

init();

</script>
<script src="https://vjs.zencdn.net/7.8.4/video.js"></script>
</body>

</html>
