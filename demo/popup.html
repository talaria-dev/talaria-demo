<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <title>Talaria</title>
  <meta name="description" content="Talaria Popup Demo">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#ffffff">  
  <link rel="icon" type="image/png" sizes="64x64"  href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABBVJREFUeNrsW01oE0EUno0Fgz0YkaIoSKIgKmLSQ0EvbXKsl1YQWi8mOXoqvXlKSM5K6KnHJKdSKCS52IuQtB4sWMhGMFYRjYJ/lNJ4qEQo6Lw4xc1kNvuT7O5M1gePDdNms++b7/3NzkjIYknMbYbxBTSI1Y81pPEVGWsDaw1rJb06WbHy+SQLDPbhyyzWGXIdhBSxluCKAWlyCQA2HGZ2AWvMYlLlsOYHxQxpQBRPEprbKQBAql8gpD6pnrFhxvUwYtGsa0gmjQffzmL1IT4EjI9jEIqWA4CNz3Iw66pswCDELQGAUL6sI405LZBGI3pdQhoy4w2DIOk0/gNH/m4kLoxjEBq9/smjc+ZFMx6RZy4QG8wBIBjtWRIiNhh3AVa0P+sfRd4TI9xb3aj/0J0dpB55vkCPxxM3kP/aSe4BqKx9QuW1j/TwHVad4FHx+6zAtEfhuxfQlYnT9HCWFQ9YMSAjaNDrnO4Hl5FvzEsHxUxPAEhjEzPgW9wKxCoAgZIYsVGVAcleN93fbQnFAohXoakzqJeNHsbKjarsbO+h1s9DoUCYjl5E3tGOzBUmaxddDIhq3ax1cIi2nnwRCgBwhVvT5+nhhQ4ASHTU1eFBehEpFoDcvH2OFQt8SgYYWrtbeVxH8sZ3oVjAiAWzSgBmjNwQXKGw/BZl0y+FiQtXu+uCts0jZhigTIuiuQPNAIlE/zJyp0Q8yP7VXK6qZnCBoJ2/6HRHSblsEJ7Eb2thcv+Sox1lcv5ZR7HoEXzBw7BQDVLI4zan940d12yHXSW2A9DkrKO0HYAqZyW07QDwVj06EgOgj+Clf3AEAIgD0Eg5EQ+au7+6AJCdAOFb4wAtP6y2l7DtBIL6LRkqwYZTxRC01bDAAgoFCp2j7QhJAEANDW4zU18z44BL1MAFKi6ugyrtV2OJuc3fbrQ+vTopHfWlRR7coJdABwnvJs0KLN2tPKorh4rKNFga9tl+/WKPHiopASgOs/FQdDFWsf8xgOylyfFsBF3AGBHGy5zc0f4hZSW4xDcALVPlM3zn+fpnejjfVQpjRGTeU+JOtx9rynr+fbvgUqY+5fZauhdI8QwAYyY1O0+G76dUmyGCDLexAPoH6B30Uh+6TobvV7S6wUX0d48dlwJ9w5YOJoDxVGndJLZ1yDF6YONVtjV1Pf4Gf5znFYR3tf02vU+1Gyhvd32LWbL99Cs9fI/EuQ4xtE2OR2F1kX1vk1OAUEXivzeQsfHjan/UWhGKOLVgMijjiQ2qomeztB9fgAkibpYOaO0Y11wTJLutA4IxQdZjvC4GKJjg3gMTAmUH647MUCAMzaEpU+8FyA8FOCmbc8TfTa1p/D84OainIUBEkT1HZ5dYZa2jAFDZwn2HpzWYAcrl8fk/AgwALwul9z7tfHgAAAAASUVORK5CYII=">  
  <!-- <script src="./client/v1/tlr-client.js"></script> -->
  <script src="https://cdn.talaria.solutions/client/v1/tlr-client.js"></script>
</head>
<body>
  <style>
    * {
      box-sizing: border-box;
    }

    html {
      width: 100%;
      height: 100%;
    }

    body {
      margin: 0;
      background-color: #f5f5f5;
      width: 100%;
      height: 100%;
      font-family: 'Roboto', sans-serif;
    }

    .myself {
      height: 80px;
      position: fixed;
      top: 0;
      width: 100%;
      background-color: #fff;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      padding: 0 10px;
      z-index: 100;
    }
    
    .myself .self-avatar-box,
    .contact .avatar-box {
      width: 60px;
      height: 60px;
      position: relative;
      margin-right: 10px;
      display: flex;
      justify-content: center;
      align-items: center;          
      border-radius: 50%;
      background-color: #ccc;
      cursor: pointer;
      flex-shrink: 0;
    }

    .presence-indicator, .self-state {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 20px;
      height: 20px;
      border: 2px solid #fff;
      display: inline-block;
      background-color: #ddd;
      border-radius: 50%;
    }

    .avatar-icon {
      font-size: 40px;
      color: #fff;      
    }

    .avatar-img {
      width: 100%;
      height: 100%;      
      border-radius: 50%;
      display: block;      
    }    

    .user-name, .self-name {      
      font-size: 18px;
      color: #222;      
    }

    .user-status, .self-status {
      font-size: 14px;
      color: #999;
    }    

    .contacts {      
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      padding: 100px 10px 60px;
    }
    
    .contact {
      color: #666;
      display: flex;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      padding: 10px;
      width: 100%;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      background-color: #FFF;
      margin-bottom: 10px;
    }

    .contact .tooltiptext.online {
      display: none;
    }

    .contact .tooltiptext.offline {
      display: block;
    }
    
    .contact.online .tooltiptext.online {
      display: block;
    }

    .contact.online .tooltiptext.offline {
      display: none;
    }

    .contact-btn {
      background-color: #ddd;
      color: #333;
      border-radius: 50%;
      padding: 10px;
      cursor: pointer;
      margin-left: 5px;
    }

    .contact.online .contact-btn {
      background-color: royalblue;
      color: #fff;
    }
    
    .mla {
      margin-left: auto !important;
    }

    .tooltip {
      position: relative;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 130px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 200;
      bottom: 125%;
      left: 50%;
      margin-left: -66px;
      opacity: 0;
      transition: opacity 0.3s;
      display: inline-block;
    }

    .tooltip.self-avatar-box .tooltiptext {
      left: 100%;
      bottom: -91%;
      margin-left: -66px;
    }

    .tooltip .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }

    .tooltip.self-avatar-box .tooltiptext::after {
      top: -10px;
      left: 28%;
      transform: rotate(180deg);
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
  </style>

  <div class="myself">
    <div class="self-avatar-box tooltip">      
      <span class="self-state"></span>
      <span class="tooltiptext">Change your presence</span>
    </div>

    <div class="self-user-info">
      <div class="self-name"></div>
      <div class="self-status"></div>
    </div>    
  </div>

  <div class="contacts"></div>

  <script>
    var status_colors = tlr.config.presence_colors;

    
    function attachSelf() {
      var $avatar_box = $('.self-avatar-box');
      var img = '<img onerror="tlr.fixImage(this, \'person\')" class="avatar-img" src="'+ tlr.config.user.avatar +'">';
      $avatar_box.prepend(img);
      
      $('.self-name').html(tlr.config.user.full_name);      
    }

    var $self_status = $('.self-status');
    var $self_state = $('.self-state');
    
    function updateSelf() {
      if (tlr.selfInfo) {
        $self_state.css('background-color', tlr.selfInfo.presence.color);
        $self_status.html(tlr.selfInfo.presence.status);
      } else {        
        $self_state.css('background-color', tlr.config.presence_colors.xa);
        $self_status.html('');
      }
    }


    function attachContacts() {
      tlr.contacts.list.forEach(function(contact){
        addContact(contact);
      });
    }


    function updateContacts() {
      tlr.contacts.list.forEach(function(contact){
        updateContact(contact.username);
      });
    }


    function updateContact(username){
      var $contact = $('.contact[data-username="'+username+'"]');
      var $state = $contact.find('.presence-indicator');
      var $status = $contact.find('.user-status');

      var online = tlr.getOnlineUser(username);

      if (online) {
        $state.css('background-color', online.presence.color);
        $status.html(online.presence.status);
        $contact.toggleClass('online', true);

      } else {
        $state.css('background-color', status_colors.xa);
        $status.html('');
        $contact.toggleClass('online', false);
      }
    } 


    function addContact(contact, prepend){
      var cont = '' +
      '<div class="contact" data-username="'+ contact.username +'">' +
        '<div class="avatar-box">' +
          '<img onerror="tlr.fixImage(this, \'person\')" class="avatar-img" src="'+ contact.avatar +'"/>' +              
          '<span class="presence-indicator" style="background-color:'+ status_colors.xa +'"></span>' +
        '</div>' +
        '<div class="user-info">' +
          '<div class="user-name">' + contact.full_name + '</div>' +
          '<div class="user-status"></div>' +
        '</div>' +
        '<div class="tooltip mla">' +
          '<i class="contact-btn material-icons" data-action="performCall">phone</i>' +
          '<span class="tooltiptext online">Perform call</span>' +          
          '<span class="tooltiptext offline">User not available at the moment</span>' +
        '</div>' +
        '<div class="tooltip">' +
          '<i class="contact-btn material-icons" data-action="openChat">chat</i>' +
          '<span class="tooltiptext online">Start chat</span>' +
          '<span class="tooltiptext offline">User not available at the moment</span>' +
        '</div>' +
        '<div class="tooltip">' +
          '<i class="contact-btn material-icons" data-action="startCobrowsing">assistant</i>' +
          '<span class="tooltiptext online">Start cobrowsing</span>' +
          '<span class="tooltiptext offline">User not available at the moment</span>' +
        '</div>' +
      '</div>';
      
      if (prepend === 'prepend') {
        $('.contacts').prepend(cont);
        
      } else {
        $('.contacts').append(cont);
      }
    }

    
    $('.contacts').on('click', 'i', (e) => {      
      var $btn = $(e.target);

      if (!$btn.parent().parent().hasClass('online')) { return; }

      var username = $(e.target).parent().parent().attr('data-username');
      var action = $(e.target).attr('data-action');      
      
      switch (action) {
        case 'performCall':
          tlr.performCall(username);
        break;

        case 'openChat':
          tlr.chat.open([tlr.config.user.username, username]);          
        break;

        case 'startCobrowsing':
          tlr.cobrowsing.requestConnection(username);        
        break;
      }
    });


    $('.self-avatar-box').on('click', function(){
      tlr.updatePresenceUi();
    });

    /*
    -----------------------------------
    TALARIA CONFIGURATION FOR THE POPUP
    -----------------------------------
    */

    tlr.init('popup');    
    

    tlr.on('onlinepresencechanged', () => {      
      updateSelf();        
      updateContacts();      
    });


    tlr.on('contactadded', function(contact){
      addContact(contact, 'prepend');
      updateContact(contact.username);
    });


    tlr.on('contactremoved', function(contact){      
      $('.contact[data-username="'+contact.username+'"]').remove();
    });
    
    attachSelf();
    attachContacts();    
  </script>
</body>
</html>
